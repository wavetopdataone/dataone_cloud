(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{"2Wyk":function(e,t,a){"use strict";a.r(t),function(e){a("Mwp2");var n=a("VXEj"),s=(a("Q9mQ"),a("diRs")),l=(a("IzEo"),a("bx4M")),o=(a("Pwec"),a("CtXQ")),r=(a("lUTK"),a("BvKs")),i=(a("Telt"),a("Tckk")),c=(a("miYZ"),a("tsqr")),u=(a("5NDa"),a("5rEg")),d=a("2Taf"),m=a.n(d),p=a("vZ4D"),h=a.n(p),f=a("l4Ni"),g=a.n(f),y=a("ujKo"),k=a.n(y),b=a("MhPg"),C=a.n(b),v=(a("B9cy"),a("Ol7k")),E=(a("y8nQ"),a("Vl3Y")),_=(a("2qtc"),a("kLXV")),w=a("q1tI"),T=a.n(w),S=a("vDqi"),I=a.n(S),x=a("jHKv"),V=a("usdK"),L=a.n(V),U=(a("kQFk"),a("UmVj")),N=a.n(U),M=_.a.confirm,R=E.a.Item,A=v.a.Content,j=v.a.Sider,O=E.a.create()(function(e){function t(e){var a;return m()(this,t),(a=g()(this,k()(t).call(this,e))).state={dept_name:e.ifCreat?"":e.formValues.dept_name,dept_id:e.ifCreat?"":e.formValues.dept_id},a}return C()(t,e),h()(t,[{key:"render",value:function(){var e=this.props,t=e.visible,a=e.onCancel,n=e.onCreate,s=e.form.getFieldDecorator;return T.a.createElement(_.a,{visible:t,title:"分组名称",okText:"确认",onCancel:a,onOk:n},T.a.createElement(E.a,null,T.a.createElement(R,{labelCol:{span:7},wrapperCol:{span:15},label:""},s("dept_name",{rules:[{required:!0,message:"请输入新建小组名称(不能超过20个字符)！",min:1,max:20}],initialValue:this.state.dept_name})(T.a.createElement(u.a,{placeholder:"请输入新建小组名称",className:N.a.nameInput}))),T.a.createElement(R,{labelCol:{span:7},wrapperCol:{span:15},label:"",style:{display:"none"}},s("id",{initialValue:this.state.dept_id})(T.a.createElement(u.a,{placeholder:"请输入新建小组名称",className:N.a.nameInput})))))}}]),t}(T.a.Component)),q=E.a.create()(function(e){function t(e){var a;return m()(this,t),(a=g()(this,k()(t).call(this,e))).passChange=function(){a.setState({message:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[^]{8,16}$/,maxNum:20})},a.state={login_name:e.formValues.login_name,email:e.formValues.email,password:e.formValues.password,user_id:e.formValues.user_id,message:"",maxNum:300},a}return C()(t,e),h()(t,[{key:"render",value:function(){var e=this.props,t=e.visible,a=e.onCancel,n=e.onCreate,s=e.form.getFieldDecorator;return T.a.createElement(_.a,{visible:t,title:"修改信息",okText:"确认",onCancel:a,onOk:n},T.a.createElement(E.a,null,T.a.createElement(R,{labelCol:{span:7},wrapperCol:{span:12},label:"用户名"},s("login_name",{rules:[{required:!0,message:"请输入正确的用户名(1～20位，格式不限文字、英文（大小写）、符号)!",min:1,max:20}],initialValue:this.state.login_name})(T.a.createElement(u.a,{placeholder:"请输入用户名"}))),T.a.createElement(R,{labelCol:{span:7},wrapperCol:{span:12},label:"邮箱"},s("email",{rules:[{required:!0,message:"请输入正确格式的邮箱!",type:"email"}],initialValue:this.state.email})(T.a.createElement(u.a,{placeholder:"请输入邮箱",type:"email"}))),T.a.createElement(R,{labelCol:{span:7},wrapperCol:{span:12},label:"密码"},s("password",{rules:[{required:!0,pattern:this.state.message,message:"请输入正确格式的密码（长度不小于8位，不大于20位，包含至少一位大写字母，一位小写字母）!",min:8,max:this.state.maxNum}],initialValue:this.state.password})(T.a.createElement(u.a,{type:"password",placeholder:"请输入密码",allowClear:!0,onChange:this.passChange}))),T.a.createElement(R,{labelCol:{span:7},wrapperCol:{span:12},label:"",style:{display:"none"}},s("id",{rules:[{required:!0}],initialValue:this.state.user_id})(T.a.createElement(u.a,{placeholder:"请输入新建小组名称",className:N.a.nameInput})))))}}]),t}(T.a.Component)),z=function(t){function a(){var t;return m()(this,a),(t=g()(this,k()(a).apply(this,arguments))).state={selectItem:"2",selectgroupItem:"001",stepValue:"1",visible:!1,visibleCreat:!1,visibleUpdate:!1,numberList:[],roleId:localStorage.getItem("role_id")},t.loadlist=function(){I()({method:"post",url:e.constants.httpType+e.constants.website+"/sys_dept/dept_all/",headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){if("401"==e.data.status&&(window.location.href="/user"),1==e.data.status){var a=e.data.data;if(1==t.state.roleId){a.unshift({dept_id:"001",dept_name:"全部",key:"001"})}t.setState({firstIntem:a[0]}),t.changeTeam(a[0]),t.setState({numberList:a})}else c.a.error(e.data.message)}).catch(function(e){})},t.personal=function(){var a={loginName:localStorage.getItem("userName")};I()({method:"post",url:e.constants.httpType+e.constants.website+"/sys_user/findRolePerms/",data:x.a.Amap(a),headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){"401"==e.data.status&&(window.location.href="/user"),t.setState({role_name:e.data[0].role_name,remark:e.data[0].remark,role_id:e.data[0].role_id})}).catch(function(e){})},t.onChange=function(){},t.addSubmit=function(a){delete a.password1;var n=2;2==t.state.role_id&&(n=3),I()({method:"post",url:e.constants.httpType+e.constants.website+"/sys_user/addUser/?id="+n,data:a,headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){"401"==e.data.status&&(window.location.href="/user"),1==e.data.status?(c.a.success("操作成功"),t.setState({userid:e.data.id,stepValue:"2"})):c.a.error(e.data.message)}).catch(function(e){})},t.handleClick=function(e){1==e.key?L.a.push("/usermanage/index"):2==e.key&&L.a.push("/usermanage/team")},t.showModal=function(e,a){1==a?t.setState({visible:!0,formValues:e}):4==a?t.setState({visibleUpdate:!0,formValuesUpdate:e}):5==a&&t.setState({visibleCreat:!0,formValuesCreat:{}})},t.handleCancel=function(){t.setState({visible:!1,formValues:{},visibleUpdate:!1,visibleCreat:!1,formValuesUpdate:{}})},t.handleCreate=function(){t.formRef.props.form.validateFields(function(e,a){e||t.handleAdd(a)})},t.saveFormRef=function(e){t.formRef=e},t.handleAdd=function(a){var n=e.constants.httpType+e.constants.website+"/sys_dept/edit_dept/";""==a.id&&(n=e.constants.httpType+e.constants.website+"/sys_dept/add_dept/",delete a.id),void 0!=a.login_name&&(n=e.constants.httpType+e.constants.website+"/sys_user/update/"),I()({method:"post",url:n,data:a,headers:{authToken:localStorage.getItem("authToken")}}).then(function(a){if("401"==a.data.status&&(window.location.href="/user"),1==a.data.status)c.a.success("操作成功"),t.changeTeam(t.state.firstIntem,t.state.selectgroupItem),n==e.constants.httpType+e.constants.website+"/sys_dept/edit_dept/"&&t.loadlist();else if(0==a.data.status)return void c.a.error(a.data.message);t.setState({visible:!1,visibleCreat:!1,visibleUpdate:!1})}).catch(function(e){})},t.color16=function(){var e=Math.floor(256*Math.random()),t=Math.floor(256*Math.random()),a=Math.floor(256*Math.random());return"#"+e.toString(16)+t.toString(16)+a.toString(16)},t.changeTeam=function(a,n){t.setState({selectgroupItem:void 0!=a.key?a.key:a.dept_id.toString()}),"001"==n&&t.setState({selectgroupItem:n});var s=e.constants.httpType+e.constants.website+"/sys_user/findUserByDept/",l={deptId:void 0!=a.key?a.key:a.dept_id.toString()};"001"!=a.key&&2!=localStorage.getItem("role_id")&&"001"!=n||(s=e.constants.httpType+e.constants.website+"/sys_user/alluser",l={}),I()({method:"post",url:s,data:x.a.Amap(l),headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){"401"==e.data.status&&(window.location.href="/user");for(var a=e.data.data,n=0;n<a.length;n++)a[n].color=t.color16();t.setState({dataList:a})}).catch(function(e){})},t.delNumber=function(e){M({title:"删除成员?",content:"请再次确认删除该成员！一旦删除，该用户将无法登录dataone!",onOk:function(){return t.stopNumber(e)},onCancel:function(){},cancelText:"取消",okText:"确认"})},t.stopNumber=function(a){var n={name:a.login_name};I()({method:"post",url:e.constants.httpType+e.constants.website+"/sys_user/delete/",data:x.a.Amap(n),headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){"401"==e.data.status&&(window.location.href="/user");e.data.status;"1"==e.data.status?(c.a.success("删除成功"),t.loadlist()):c.a.error("抱歉，您无法删除小组！请将小组内相关的全部任务删除才能删除小组")}).catch(function(e){})},t.stopUser=function(e){M({title:"冻结用户?",content:"是否确认冻结该用户？",onOk:function(){return t.stopajax(e,1)},onCancel:function(){},cancelText:"取消",okText:"确认"})},t.startUser=function(e){M({title:"解冻用户?",content:"是否确认解冻该用户？",onOk:function(){return t.stopajax(e,2)},onCancel:function(){},cancelText:"取消",okText:"确认"})},t.stopajax=function(a,n){var s={id:a.user_id,status:1==n?0:1};I()({method:"post",url:e.constants.httpType+e.constants.website+"/sys_user/updateStatus/",data:x.a.Amap(s),headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){"401"==e.data.status&&(window.location.href="/user");e.data.status;"1"!=e.data.status&&"2"!=e.data.status||(c.a.success("操作成功"),t.changeTeam(a,t.state.selectgroupItem))}).catch(function(e){})},t.deleteGroup=function(e){M({title:"删除小组?",content:"请再次确认删除小组！一旦删除小组，组内的全部成员将被删除！",onOk:function(){return t.delajax(e)},onCancel:function(){},cancelText:"取消",okText:"确认"})},t.delajax=function(a){var n={deptName:a.dept_name};I()({method:"post",url:e.constants.httpType+e.constants.website+"/sys_dept/del_dept/",data:x.a.Amap(n),headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){"401"==e.data.status&&(window.location.href="/user");e.data.status;"1"==e.data.status?(c.a.success("删除成功"),t.loadlist()):c.a.error("抱歉，您无法删除小组！请将小组内相关的全部任务删除才能删除小组")}).catch(function(e){})},t.findUserByDept=function(a){var n={userId:a.user_id},s=e.constants.httpType+e.constants.website+"/sys_user/selectUser/";I()({method:"post",url:s,data:x.a.Amap(n),headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){if("401"==e.data.status&&(window.location.href="/user"),0!=e.data.status){for(var n=e.data.data,s=0;s<n.length;s++)n[s].color=t.color16();t.setState({userList:n}),t.showConfirm(a)}else c.a.error("该分组没有成员，无法完成移交工作")}).catch(function(e){})},t.checkUser=function(e,a){t.setState({checkUserid:a.user_id}),0!=document.getElementsByClassName("addStyle").length&&(document.getElementsByClassName("addStyle")[0].classList.add("aList"),document.getElementsByClassName("addStyle")[0].classList.remove("addStyle"));var n=e.target;if(-1!=n.className.indexOf("aList"))return n.classList.remove("aList"),n.classList.add("addStyle"),n;for(;-1==n.className.indexOf("aList");)n=n.parentNode;n.classList.remove("aList"),n.classList.add("addStyle")},t.transfer=function(a){var n={userId:t.state.checkUserid,id:a.user_id},s=e.constants.httpType+e.constants.website+"/sys_user/HandedTeam/";I()({method:"post",url:s,data:x.a.Amap(n),headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){"401"==e.data.status&&(window.location.href="/user"),1==e.data.status?(c.a.success("移交成功"),t.changeTeam(a,t.state.selectgroupItem)):c.a.error(e.data.message)}).catch(function(e){})},t.showConfirm=function(e){M({title:T.a.createElement("span",null,"移交团队",T.a.createElement("span",{style:{fontSize:12,color:"#999"}},"（ 每个小组只有1位管理员，只能移交给同组成员 ) ")),width:500,content:T.a.createElement("span",null,t.state.userList.map(function(e){return T.a.createElement("span",{className:"aList",style:{margin:"10px 0",cursor:"pointer",padding:"10px 0",display:"inline-block",width:198},onClick:function(a){return t.checkUser(a,e)}},T.a.createElement(i.a,{style:{color:"#fff",backgroundColor:e.color,verticalAlign:"middle",fontSize:18,marginLeft:10},size:"large"},e.login_name.substr(0,1)),"  ",e.login_name,"    ")})),onOk:function(){return t.transfer(e)},onCancel:function(){},cancelText:"取消",okText:"确认"})},t.contentlist=function(e){return T.a.createElement("div",null,T.a.createElement("p",null,T.a.createElement("a",{onClick:function(a){return t.showModal(e,1)}},"重命名")),T.a.createElement("p",null,T.a.createElement("a",{onClick:function(a){return t.deleteGroup(e)}},"删除")))},t.numberlist=function(e){return T.a.createElement("div",null,T.a.createElement("p",{style:{display:1==t.state.roleId?"block":"none"}},T.a.createElement("a",{onClick:function(a){return t.findUserByDept(e)}},"移交团队")),T.a.createElement("p",{style:{display:1==t.state.roleId?"none":"block"}},T.a.createElement("a",{onClick:function(a){return t.delNumber(e,2)}},"删除成员")),T.a.createElement("p",null,T.a.createElement("a",{style:{display:1==e.status?"block":"none"},onClick:function(a){return t.stopUser(e)}},"冻结用户"),T.a.createElement("a",{style:{display:0==e.status?"block":"none"},onClick:function(a){return t.startUser(e)}},"解冻用户")),T.a.createElement("p",null,T.a.createElement("a",{onClick:function(a){return t.showModal(e,4)}},"修改信息")))},t.colorList=["#f56a00","#7265e6","#ffbf00","#00a2ae"],t}return C()(a,t),h()(a,[{key:"componentDidMount",value:function(){this.loadlist()}},{key:"render",value:function(){var e=this;return T.a.createElement(v.a,{className:N.a.layoutBox},T.a.createElement(j,{width:160,style:{background:"#fff",borderRight:"1px solid #eee",paddingTop:"20px"}},T.a.createElement(r.b,{mode:"inline",style:{width:160},selectedKeys:[this.state.selectItem],onClick:this.handleClick},T.a.createElement(r.b.Item,{key:"1"},T.a.createElement(o.a,{type:"home"}),"创建成员"),T.a.createElement(r.b.Item,{key:"2"},T.a.createElement(o.a,{type:"file"}),"团队设置"))),T.a.createElement(A,{style:{background:"#fff",paddingLeft:24,minHeight:280}},T.a.createElement(l.a,{title:"团队信息",style:{marginTop:20}},T.a.createElement("p",{style:{color:"#4664b4",display:2==this.state.roleId?"none":""}},T.a.createElement(o.a,{type:"plus-circle",style:{color:"#4664b4",fontSize:16,marginRight:10}}),T.a.createElement("a",{onClick:function(t){return e.showModal(null,5)}},"创建分组")),T.a.createElement(r.b,{mode:"inline",style:{width:260,float:"left"},selectedKeys:[this.state.selectgroupItem],onClick:this.changeTeam},this.state.numberList.map(function(t){return T.a.createElement(r.b.Item,{key:t.dept_id.toString(),title:t.dept_name},t.dept_name.length>10?t.dept_name.substring(0,10)+"...":t.dept_name,T.a.createElement(s.a,{content:e.contentlist(t),trigger:"hover",placement:"right"},T.a.createElement(o.a,{type:"ellipsis",style:{float:"right",marginTop:13,display:1==e.state.roleId&&"001"==!t.key?"inline-block":"none"}})))})),T.a.createElement("div",{style:{float:"left",marginLeft:80,width:"60%"}},T.a.createElement(n.a,{itemLayout:"horizontal",dataSource:this.state.dataList,renderItem:function(t){return T.a.createElement(n.a.Item,{actions:"超级管理员"==t.role_name?[T.a.createElement("span",null,t.dept_name," ",t.role_name)]:2==localStorage.getItem("role_id")&&"管理员"==t.role_name?[T.a.createElement("span",null,t.dept_name," ",t.role_name)]:[T.a.createElement("span",null,t.dept_name," ",t.role_name),T.a.createElement(s.a,{content:e.numberlist(t),trigger:"hover",placement:"right",style:{display:"超级管理员"==t.role_name?"none":"block"}},T.a.createElement(o.a,{type:"setting",style:{display:"超级管理员"==t.role_name?"none":"block"}}))]},T.a.createElement(n.a.Item.Meta,{avatar:T.a.createElement(i.a,{style:{color:"#fff",backgroundColor:t.color,verticalAlign:"middle",fontSize:18},size:"large"},t.login_name.substr(0,1)),title:T.a.createElement("a",null,t.login_name),description:t.email}))}}))),this.state.visible?T.a.createElement(O,{wrappedComponentRef:this.saveFormRef,visible:this.state.visible,onCancel:this.handleCancel,ifCreat:!1,onCreate:function(){return e.handleCreate()},formValues:this.state.formValues}):null,this.state.visibleCreat?T.a.createElement(O,{wrappedComponentRef:this.saveFormRef,visible:this.state.visibleCreat,ifCreat:!0,onCancel:this.handleCancel,onCreate:function(){return e.handleCreate()}}):null,this.state.visibleUpdate?T.a.createElement(q,{wrappedComponentRef:this.saveFormRef,visible:this.state.visibleUpdate,onCancel:this.handleCancel,onCreate:function(){return e.handleCreate()},formValues:this.state.formValuesUpdate}):null))}}]),a}(w.PureComponent);t.default=z}.call(this,a("yLpj"))}}]);