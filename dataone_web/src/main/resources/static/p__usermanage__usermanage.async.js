(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{Mbd7:function(e,t,a){"use strict";a.r(t),function(e){a("+L6B");var n=a("2/Rp"),s=(a("5NDa"),a("5rEg")),r=(a("IzEo"),a("bx4M")),o=(a("y8nQ"),a("Vl3Y")),l=(a("Pwec"),a("CtXQ")),i=(a("lUTK"),a("BvKs")),c=(a("miYZ"),a("tsqr")),u=(a("2qtc"),a("kLXV")),d=a("2Taf"),m=a.n(d),h=a("vZ4D"),p=a.n(h),f=a("l4Ni"),y=a.n(f),b=a("ujKo"),g=a.n(b),w=a("MhPg"),v=a.n(w),k=(a("B9cy"),a("Ol7k")),_=a("q1tI"),S=a.n(_),E=a("TBiY"),C=a("QtVJ"),I=a("vDqi"),T=a.n(I),j=a("usdK"),R=a.n(j),x=(a("kQFk"),a("UmVj")),K=a.n(x),D=function(e,t,a,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,a):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,n);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(o=(r<3?s(o):r>3?s(t,a,o):s(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},N=k.a.Content,V=k.a.Sider,J=function(t){function a(){var t;return m()(this,a),(t=y()(this,g()(a).apply(this,arguments))).state={selectItem:"1",stepValue:"1"},t.personal=function(){3!=localStorage.getItem("role_id")?T()({method:"post",url:e.constants.httpType+e.constants.website+"/sys_role/find_role/",headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){"401"==e.data.status&&(window.location.href="/user"),t.setState({role_name:e.data.data[0].role_name,remark:e.data.data[0].remark,role_id:e.data.data[0].id})}).catch(function(e){}):u.a.warning({title:"警告",content:"您没有权限查看用户管理模块",onOk:function(){window.location.href="/busList"},okText:"回到首页"})},t.onChange=function(){t.setState({stepValue:"2"})},t.handleSubmit=function(e){e.preventDefault(),t.props.form.validateFields(function(e,a){e||(a.password==a.password1?t.addSubmit(a):c.a.error("密码不一致！"))})},t.addSubmit=function(a){delete a.password1;var n=2;3==t.state.role_id&&(n=3),T()({method:"post",url:e.constants.httpType+e.constants.website+"/sys_user/addUser/?id="+n,data:a,headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){"401"==e.data.status&&(window.location.href="/user"),1==e.data.status?(c.a.success("操作成功"),t.setState({userid:e.data.id,stepValue:"2"})):c.a.error(e.data.message)}).catch(function(e){})},t.handleClick=function(e){1==e.key?R.a.push("/usermanage/index"):2==e.key&&R.a.push("/usermanage/team")},t}return v()(a,t),p()(a,[{key:"componentDidMount",value:function(){this.personal()}},{key:"render",value:function(){var e=this.props.form.getFieldDecorator;return S.a.createElement(k.a,{className:K.a.layoutBox},S.a.createElement(V,{width:160,style:{background:"#fff",borderRight:"1px solid #eee",paddingTop:"20px"}},S.a.createElement(i.b,{mode:"inline",style:{width:160},selectedKeys:[this.state.selectItem],onClick:this.handleClick},S.a.createElement(i.b.Item,{key:"1"},S.a.createElement(l.a,{type:"home"}),"创建成员"),S.a.createElement(i.b.Item,{key:"2"},S.a.createElement(l.a,{type:"file"}),"团队设置"))),S.a.createElement(N,{style:{background:"#fff",padding:24,minHeight:280}},S.a.createElement("div",{className:"1"==this.state.stepValue?"show":"hide"},S.a.createElement(o.a,{onSubmit:this.handleSubmit,className:K.a.inputItem},S.a.createElement(r.a,{title:"基本信息"},S.a.createElement(o.a.Item,{labelCol:{span:7},wrapperCol:{span:8},label:"用户名"},e("login_name",{rules:[{required:!0,message:"请输入正确的用户名(1～20位，格式不限文字、英文（大小写）、符号)!",min:1,max:20}]})(S.a.createElement(s.a,{placeholder:"请输入用户名"}))),S.a.createElement(o.a.Item,{labelCol:{span:7},wrapperCol:{span:8},label:"邮箱"},e("email",{rules:[{required:!0,message:"请输入正确格式的邮箱!",type:"email"}]})(S.a.createElement(s.a,{type:"email",placeholder:"请输入邮箱"}))),S.a.createElement(o.a.Item,{labelCol:{span:7},wrapperCol:{span:8},label:"密码"},e("password",{rules:[{required:!0,pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[^]{8,16}$/,message:"请输入正确格式的密码（长度不小于8位，不大于20位，包含至少一位大写字母，一位小写字母）!",min:8,max:20}]})(S.a.createElement(s.a,{type:"password",placeholder:"请输入密码"}))),S.a.createElement(o.a.Item,{labelCol:{span:7},wrapperCol:{span:8},label:"确认密码"},e("password1",{rules:[{required:!0,pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[^]{8,16}$/,message:"请输入正确格式的密码（长度不小于8位，不大于20位，包含至少一位大写字母，一位小写字母）!",min:8,max:20}]})(S.a.createElement(s.a,{type:"password",placeholder:"请再次输入密码"})))),S.a.createElement(r.a,{title:"角色选择",style:{marginTop:20}},S.a.createElement("p",null,S.a.createElement("span",{className:K.a.inputTitle},this.state.role_name,"："),S.a.createElement("span",{style:{color:"rgba(0,0,0,0.4)",fontSize:12}},this.state.remark))),S.a.createElement(n.a,{type:"primary",htmlType:"submit",className:K.a.nexBtn,onClick:this.handleSubmit},"下一步"))),S.a.createElement("div",{className:"2"==this.state.stepValue&&2==this.state.role_id?"show":"hide"},S.a.createElement(E.a,{userid:this.state.userid})),S.a.createElement("div",{className:"2"==this.state.stepValue&&3==this.state.role_id?"show":"hide"},S.a.createElement(C.a,{userid:this.state.userid}))))}}]),a}(_.PureComponent);J=D([o.a.create()],J),t.default=J}.call(this,a("yLpj"))},QtVJ:function(e,t,a){"use strict";(function(e){a("g9YV");var n=a("wCAj"),s=(a("IzEo"),a("bx4M")),r=a("p0pE"),o=a.n(r),l=(a("miYZ"),a("tsqr")),i=(a("Pwec"),a("CtXQ")),c=(a("+L6B"),a("2/Rp")),u=a("2Taf"),d=a.n(u),m=a("vZ4D"),h=a.n(m),p=a("l4Ni"),f=a.n(p),y=a("ujKo"),b=a.n(y),g=a("MhPg"),w=a.n(g),v=(a("5NDa"),a("5rEg")),k=(a("OaEy"),a("2fM7")),_=(a("2qtc"),a("kLXV")),S=a("q1tI"),E=a.n(S),C=a("vDqi"),I=a.n(C),T=a("jHKv"),j=(a("kQFk"),a("UmVj")),R=a.n(j),x=(_.a.confirm,k.a.Option,v.a.Search,function(t){function a(t){var n;return d()(this,a),(n=f()(this,b()(a).call(this,t))).searchJob=function(){var t={userId:localStorage.getItem("userId")};I()({method:"post",url:e.constants.httpType+e.constants.website+"/sys_jobrela/findUserJob/",data:T.a.Amap(t),headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){if("401"==e.data.status&&(window.location.href="/user"),1==e.data.status){for(var t=e.data.data,a=[],s=0;s<t.length;s++){var r={key:t[s].job_id,job_id:t[s].job_id,job_name:t[s].job_name,user_name:t[s].user_name,create_time:t[s].create_time,create_user:t[s].create_user};a.push(r)}n.setState({datanoSource:a})}}).catch(function(e){})},n.searchjoinJob=function(){var t={userId:n.state.userid};I()({method:"post",url:e.constants.httpType+e.constants.website+"/sys_jobrela/findUserJob/",data:T.a.Amap(t),headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){if("401"==e.data.status&&(window.location.href="/user"),1==e.data.status){for(var t=e.data.data,a=[],s=0;s<t.length;s++){var r={key:t[s].job_id,job_id:t[s].job_id,job_name:t[s].job_name,user_name:t[s].user_name,create_time:t[s].create_time,create_user:t[s].create_user};a.push(r)}n.setState({dataeditSource:a}),0==e.data.data.length&&n.setState({ifJoin:!1})}}).catch(function(e){})},n.searchnoJob=function(){var t={userId:n.state.userid};I()({method:"post",url:e.constants.httpType+e.constants.website+"/sys_jobrela/findUserJobNo/",data:T.a.Amap(t),headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){if("401"==e.data.status&&(window.location.href="/user"),1==e.data.status){for(var t=e.data.data,a=[],s=0;s<t.length;s++){var r={key:t[s].job_id,job_id:t[s].job_id,job_name:t[s].job_name,user_name:t[s].user_name,create_time:t[s].create_time,create_user:t[s].create_user};a.push(r)}n.setState({datanoSource:a})}}).catch(function(e){})},n.getColumnSearchProps=function(e){return{filterDropdown:function(e){var t=e.setSelectedKeys,a=e.selectedKeys,s=e.confirm,r=e.clearFilters;return E.a.createElement("div",{style:{padding:12},className:"ant-table-filter-dropdown"},E.a.createElement(v.a,{ref:function(e){n.searchInput=e},placeholder:"请输入搜索关键字",value:a[0],onChange:function(e){return t(e.target.value?[e.target.value]:[])},onPressEnter:function(){return n.handleSearch(a,s)},style:{width:188,marginBottom:8,display:"block"}}),E.a.createElement(c.a,{type:"primary",onClick:function(){return n.handleSearch(a,s)},icon:"search",size:"small",style:{width:90,marginRight:8}},"搜索"),E.a.createElement(c.a,{onClick:function(){return n.handleReset(r)},size:"small",style:{width:90}},"重置"))},filterIcon:function(e){return E.a.createElement(i.a,{type:"search",style:{color:e?"#1890ff":void 0}})},onFilter:function(t,a){return a[e].toString().toLowerCase().includes(t.toLowerCase())},onFilterDropdownVisibleChange:function(e){e&&setTimeout(function(){return n.searchInput.select()})}}},n.handleSearch=function(e,t){t(),n.setState({searchText:e[0]})},n.handleReset=function(e){e(),n.setState({searchText:""})},n.deleteBus=function(){if(null!=n.state.selectedRowKeys&&void 0!=n.state.selectedRowKeys&&0!=n.state.selectedRowKeys.length){var t={jobrela_id:n.state.selectedRowKeys,userId:n.state.userid};I()({method:"post",url:e.constants.httpType+e.constants.website+"/sys_jobrela/deleteUserJobRela/",data:T.a.Amap(t),headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){"401"==e.data.status&&(window.location.href="/user"),1==e.data.status&&(l.a.success("删除成功"),n.searchjoinJob(),n.searchnoJob(),n.setState({selectedRowKeys:null,selectedRowKeys2:null}))}).catch(function(e){})}else l.a.error("请选择要删除的任务！")},n.addBus=function(){if(void 0!=n.state.selectedRowKeys2&&null!=n.state.selectedRowKeys2&&0!=n.state.selectedRowKeys2.length){var t={jobrela_id:n.state.selectedRowKeys2,userId:n.state.userid};I()({method:"post",url:e.constants.httpType+e.constants.website+"/sys_jobrela/addUserJob/",data:T.a.Amap(t),headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){"401"==e.data.status&&(window.location.href="/user"),1==e.data.status&&(l.a.success("添加成功"),n.setState({selectedRowKeys2:null}),n.searchjoinJob(),n.searchnoJob(),n.setState({ifJoin:!0}))}).catch(function(e){})}else l.a.error("请选择要绑定的参与的任务")},n.columnsusermanage=[o()({title:"名称",dataIndex:"job_name",key:"job_name",width:200},n.getColumnSearchProps("job_name")),o()({title:"参与人",dataIndex:"user_name",key:"user_name",width:260},n.getColumnSearchProps("user_name")),{title:"修改时间",dataIndex:"create_time",key:"create_time",width:180},{title:"最后修改人",dataIndex:"create_user",key:"create_user"}],n.onSelectChange=function(e,t){n.setState({selectedRowKeys:e})},n.onSelectChange2=function(e,t){n.setState({selectedRowKeys2:e})},n.finish=function(){window.location.href="/usermanage/index"},n.state={dataSource:[],ifJoin:!1},n}return w()(a,t),h()(a,[{key:"componentDidMount",value:function(){this.searchJob()}},{key:"componentWillReceiveProps",value:function(e){this.setState({userid:e.userid})}},{key:"render",value:function(){var e=this.state,t=e.selectedRowKeys,a=(e.selectedRowKeys2,{selectedRowKeys:t,onChange:this.onSelectChange,getCheckboxProps:function(e){return{disabled:"Disabled User"===e.name,name:e.name}}}),r={selectedRowKeys:this.state.selectedRowKeys2,onChange:this.onSelectChange2,getCheckboxProps:function(e){return{disabled:"Disabled User"===e.name,name:e.name}}};return E.a.createElement("div",null,E.a.createElement(s.a,{title:"已参与任务",extra:E.a.createElement(c.a,{type:"primary",onClick:this.deleteBus},"解除任务"),style:{border:"none",display:this.state.ifJoin?"block":"none"},className:R.a.tableCard},E.a.createElement(n.a,{className:R.a.tableBox,rowSelection:a,dataSource:this.state.dataeditSource,columns:this.columnsusermanage,pagination:!1,scroll:{y:200}})),E.a.createElement(s.a,{title:"选择参与的任务",extra:E.a.createElement(c.a,{type:"primary",onClick:this.addBus},"绑定任务"),className:R.a.tableCard},E.a.createElement(n.a,{className:R.a.tableBox,rowSelection:r,dataSource:this.state.datanoSource,columns:this.columnsusermanage,pagination:!1,scroll:{y:360}})),E.a.createElement(c.a,{type:"primary",onClick:this.finish,style:{float:"right",marginTop:10}},"完成任务分配"))}}]),a}(S.PureComponent));t.a=x}).call(this,a("yLpj"))},TBiY:function(e,t,a){"use strict";(function(e){a("+L6B");var n=a("2/Rp"),s=(a("g9YV"),a("wCAj")),r=(a("Pwec"),a("CtXQ")),o=(a("Q9mQ"),a("diRs")),l=(a("IzEo"),a("bx4M")),i=(a("sRBo"),a("kaz8")),c=(a("miYZ"),a("tsqr")),u=(a("5NDa"),a("5rEg")),d=a("2Taf"),m=a.n(d),h=a("vZ4D"),p=a.n(h),f=a("l4Ni"),y=a.n(f),b=a("ujKo"),g=a.n(b),w=a("MhPg"),v=a.n(w),k=(a("y8nQ"),a("Vl3Y")),_=(a("2qtc"),a("kLXV")),S=a("q1tI"),E=a.n(S),C=a("vDqi"),I=a.n(C),T=a("jHKv"),j=(a("kQFk"),a("usdK")),R=a.n(j),x=a("UmVj"),K=a.n(x),D=(_.a.confirm,k.a.Item),N=k.a.create()(function(e){function t(e){var a;return m()(this,t),(a=y()(this,g()(t).call(this,e))).state={},a}return v()(t,e),p()(t,[{key:"render",value:function(){var e=this.props,t=e.visible,a=e.onCancel,n=e.onCreate,s=e.form.getFieldDecorator;return E.a.createElement(_.a,{visible:t,title:"分组名称",okText:"确认",onCancel:a,onOk:n},E.a.createElement(k.a,null,E.a.createElement(D,{labelCol:{span:7},wrapperCol:{span:15},label:""},s("dept_name",{rules:[{required:!0,message:"请输入新建小组名称(不能超过20个字符)！",min:1,max:20}],initialValue:""})(E.a.createElement(u.a,{placeholder:"请输入新建小组名称",className:K.a.nameInput})))))}}]),t}(E.a.Component)),V=function(t){function a(t){var n;return m()(this,a),(n=y()(this,g()(a).call(this,t))).loadList=function(){I()({method:"post",url:e.constants.httpType+e.constants.website+"/sys_dept/dept_all/",headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){if("401"==e.data.status&&(window.location.href="/user"),1==e.data.status){for(var t=e.data.data,a=[],s=0;s<t.length;s++){var r={key:t[s].dept_id,dept_name:t[s].dept_name,count_user:t[s].count_user};a.push(r)}n.setState({dataSource:a}),n.setState({visible:!1,visibleTarget:!1,visibleDetail:!1})}else c.a.error(e.data.message)}).catch(function(e){})},n.showModal=function(){n.setState({visible:!0,formValues:{}})},n.handleCancel=function(){n.setState({visible:!1,formValuesBusUpdate:{}})},n.handleCreate=function(){n.formRef.props.form.validateFields(function(e,t){e||n.handleAdd(t)})},n.saveFormRef=function(e){n.formRef=e},n.handleAdd=function(t){var a=e.constants.httpType+e.constants.website+"/sys_dept/add_dept/";I()({method:"post",url:a,data:t,headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){if("401"==e.data.status&&(window.location.href="/user"),1==e.data.status)c.a.success("操作成功"),n.loadList();else if(0==e.data.status)return void c.a.error(e.data.message);n.setState({visible:!1,visibleTarget:!1,visibleDetail:!1})}).catch(function(e){})},n.addGroup=function(){var t={id:n.state.userid,DeptId:n.state.depId};if(""!=n.state.depId&&void 0!=n.state.depId){var a=e.constants.httpType+e.constants.website+"/sys_user/updateUser/";I()({method:"post",url:a,data:T.a.Amap(t),headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){if("401"==e.data.status&&(window.location.href="/user"),1==e.data.status)c.a.success("人员创建分组成功"),R.a.push("/usermanage");else if(0==e.data.status)return void c.a.error(e.data.message);n.setState({visible:!1,visibleTarget:!1,visibleDetail:!1})}).catch(function(e){})}else c.a.error("请先选择分组")},n.onChange=function(e){n.setState({depId:e.key})},n.columns=[{title:"名称",dataIndex:"dept_name",key:"dept_name",render:function(e,t){return E.a.createElement("span",{className:1==t.count_user?K.a.diabledItem:""},t.dept_name)}},{title:"操作",dataIndex:"user",key:"user",render:function(e,t){return E.a.createElement(i.a,{checked:n.state.depId==t.key,key:t.key,onChange:function(){return n.onChange(t)},disabled:1==t.count_user})}}],n.state={visible:!1,dataSource:[]},n}return v()(a,t),p()(a,[{key:"componentDidMount",value:function(){this.loadList()}},{key:"componentWillReceiveProps",value:function(e){this.setState({userid:e.userid})}},{key:"render",value:function(){var e=this,t=E.a.createElement("div",null,E.a.createElement("p",null,"1. 一个小组只能配置一个管理员"),E.a.createElement("p",null,"2. 已有管理员小组为置灰状态，不可选择"),E.a.createElement("p",null,"3. 如无合适小组可选，请创建新分组"));return E.a.createElement("div",null,E.a.createElement(l.a,{title:E.a.createElement("span",null,"选择分组   ",E.a.createElement(o.a,{placement:"right",content:t,trigger:"hover"},E.a.createElement(r.a,{style:{cursor:"pointer"},type:"question-circle"}))),className:K.a.tableCard,extra:E.a.createElement("a",{href:"#",onClick:this.showModal},"增加分组")},E.a.createElement(s.a,{dataSource:this.state.dataSource,columns:this.columns,pagination:!1,scroll:{y:360}})),E.a.createElement(n.a,{type:"primary",className:K.a.nexBtn,onClick:this.addGroup},"确定"),this.state.visible?E.a.createElement(N,{wrappedComponentRef:this.saveFormRef,visible:this.state.visible,onCancel:this.handleCancel,onCreate:function(){return e.handleCreate()}}):null)}}]),a}(S.PureComponent);t.a=V}).call(this,a("yLpj"))}}]);